packages:
    yum:
        mod24_ssl: []

Resources:
    AWSEBAutoScalingGroup:
        Metadata:
            AWS::CloudFormation::Authentication:
                s3auth:
                    type: "s3"
                    buckets: ["elasticbeanstalk-us-west-2-989307508614"]
                    roleName: 
                        "Fn::GetOptionSetting": 
                            Namespace: "aws:autoscaling:launchconfiguration"
                            OptionName: "IamInstanceProfile"
                            DefaultValue: "aws-elasticbeanstalk-ec2-role"

files:
    /etc/httpd/conf.d/ssl.conf:
        mode: "000644"
        owner: root
        group: root
        content: |
            LoadModule ssl_module modules/mod_ssl.so
            Listen 443
            <VirtualHost *:443>
                <Proxy *>
                    Order deny,allow
                    Allow from all
                </Proxy>
            
                SSLEngine             on
                SSLCertificateFile    "/etc/pki/tls/certs/server.crt"
                SSLCertificateKeyFile "/etc/pki/tls/certs/server.key"
                SSLCipherSuite        EECDH+AESGCM:EDH+AES256+EECDH:AES256+EDH
                SSLProtocol           All -SSLv2 -SSLv3
                SSLHonorCipherOrder   on
                SSLSessionTickets     off

                Header always set Strict-Transport-Security "max-age=63072000; includeSubdomains; preload"
                Header always set X-Frame-Options DENY
                Header always set X-Content-Type-Options nosniff
        
                ProxyPass / http://localhost:80/ retry=0
                ProxyPassReverse / http://localhost:80/
                ProxyPreserveHost on
                RequestHeader set X-Forwarded-Proto "https" early
            </VirtualHost>

    /etc/pki/tls/certs/server.key:
        mode: "000400"
        owner: root
        group: root
        content: |
            -----BEGIN PRIVATE KEY-----
            MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCdinK9WYsxRQGT
            zYU64qlT1wn/D4B5/wImM0jOAJwfH1OTFzm5QHwNOkSEETn9r/em8AQHXRWfyGiW
            i48HGfiyTUo58tVjmLRXPyB7vGQJdqSRgEU1Hj1aGFrj4Ky4YzgvzpBiWDbN5gYt
            6ByBB44qSq1XKZqqMNi08RtYR8TGg6MXrgt+w8HBZJA7PaxwZzG8ebZVy3GGkW1E
            poV2F5ypfTVftTRb3STI6Xy9+rLc0+XqeCUhgAMAJ2e7oJXGQbf8E2TyxSgy+181
            UW98kA+0dVV6ZTzXmkPDmDM7nMvaes32jPchBvfHzPxtJlZV2fCatVZaB1D58uSZ
            /H3OX1s/AgMBAAECggEAYxHWd+aglro7dLQQrWgubY/UNHaOJ6nKszUa+pj9lMDB
            cMVxQmMf372dqqOeoT8QcQWMswjBeXqw8sMOjbuyXoYmQGzJ7ljwR9Fl3wooqp7W
            fL16SB4dHNQmDBmU5FtY0Q+IUqAAzthxWFsX2bhjmYremOqL3azcCmV4+bogL2lJ
            30yGEFt0V+sD7wC9qwD1qy83s3a68Y72s5lA8qzpptknNxySY3PUVRRIJ3HxTz6V
            y8oat02Eg4BWWEH9cDCc3YKiDkTxEZLkWPeX4O8LQIHMpy2grILT4SpQ1SyarV01
            Q0IeN5mLjC9G5bAquJL9uzd1o0z+i3tOcFBCIlEYKQKBgQDQKW1AbqFyRTzH1vbt
            4W6JkDa6I0s5YQyfitrCfLvAN6ZxOPZjtBWo9RGaQaJhaBIDspjnkJvpGv9ZWTC4
            aY2gITDQituNtvihvNySn+abW4VsjubHLGuwlGqgQZmvQcqhznOGpnLPitmt5eql
            5IlJR/Yh4QX4/6zFSuJJRtL3RQKBgQDBvuMOs8Uhs/PHqJs36ReMpfRXIzYbFjUp
            pFqJ7t5FtV99dIKXFfjkccOXAPAZ15j2D+UDoKeZ2spJTer5lJhutI5j00lsB9dL
            5EdDnIvDAHuyByC28IziO8rqL1SA7uGpsnFGbYX7N8Vgn3oNLX31mD9my2rRcXHr
            x5dd5s7+swKBgDnj64BJxBh1bOveupl5YjZbpvypKBhzBwGvqhsAeW6Bi4ZdYxhj
            UsrELPsLWc9hE/F3T9LGgrWXToBYr5X5tOtdj6fPljOZORgx393fHlECaN7B9yhZ
            EDHxdJ3Q4J6+202YjsRZsgBKCzOzh0hPgGai3q6ZWAHhiPjtVHUwfydJAoGBAIJZ
            6LASmTYEuaaCNPRX+gUh/pPF1/g/Z8M9lcCpmpgx4C4q/lWibdNdCygEdIYefQZI
            SV+4birgfir1pnsG08vf5NEa7ZImcF7aFmxR3eJz58UucH9EtrTbX7lR4LvifKdM
            rFOjCnqr2jsY8Of+zHk5VqbVg2eouOnWXmvKB0hrAoGAKRTBPCGzDXm8cmvEJg9F
            AFPTtfC4v07d8dIMXTGXeoTzgao2jqbv7GDjiqa+mgoOJXVw/Qw15ZUDB76cPsfQ
            CNldJkbIAyWVXHUPRWSpCP97douN1vCpCfLETISlhk1EhAjjRnxEUAsqeP6ZPoIn
            3HMMigy7FzAEHjIF5S6XrMY=
            -----END PRIVATE KEY-----

    /etc/pki/tls/certs/server.crt:
        mode: "000400"
        owner: root
        group: root
        content: |
            -----BEGIN CERTIFICATE-----
            MIIGKDCCBRCgAwIBAgISA2ZOfXmYFZjub2rqvUtE3aP9MA0GCSqGSIb3DQEBCwUA
            MEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQD
            ExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0xODA5MzAxODEyNDZaFw0x
            ODEyMjkxODEyNDZaMB4xHDAaBgNVBAMTE2ZpbmRjaGVlc2VoZWFkcy5jb20wggEi
            MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCdinK9WYsxRQGTzYU64qlT1wn/
            D4B5/wImM0jOAJwfH1OTFzm5QHwNOkSEETn9r/em8AQHXRWfyGiWi48HGfiyTUo5
            8tVjmLRXPyB7vGQJdqSRgEU1Hj1aGFrj4Ky4YzgvzpBiWDbN5gYt6ByBB44qSq1X
            KZqqMNi08RtYR8TGg6MXrgt+w8HBZJA7PaxwZzG8ebZVy3GGkW1EpoV2F5ypfTVf
            tTRb3STI6Xy9+rLc0+XqeCUhgAMAJ2e7oJXGQbf8E2TyxSgy+181UW98kA+0dVV6
            ZTzXmkPDmDM7nMvaes32jPchBvfHzPxtJlZV2fCatVZaB1D58uSZ/H3OX1s/AgMB
            AAGjggMyMIIDLjAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEG
            CCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFPVzyaFGPca7LQSU9z54
            w4C64/ptMB8GA1UdIwQYMBaAFKhKamMEfd265tE5t6ZFZe/zqOyhMG8GCCsGAQUF
            BwEBBGMwYTAuBggrBgEFBQcwAYYiaHR0cDovL29jc3AuaW50LXgzLmxldHNlbmNy
            eXB0Lm9yZzAvBggrBgEFBQcwAoYjaHR0cDovL2NlcnQuaW50LXgzLmxldHNlbmNy
            eXB0Lm9yZy8wNwYDVR0RBDAwLoITZmluZGNoZWVzZWhlYWRzLmNvbYIXd3d3LmZp
            bmRjaGVlc2VoZWFkcy5jb20wgf4GA1UdIASB9jCB8zAIBgZngQwBAgEwgeYGCysG
            AQQBgt8TAQEBMIHWMCYGCCsGAQUFBwIBFhpodHRwOi8vY3BzLmxldHNlbmNyeXB0
            Lm9yZzCBqwYIKwYBBQUHAgIwgZ4MgZtUaGlzIENlcnRpZmljYXRlIG1heSBvbmx5
            IGJlIHJlbGllZCB1cG9uIGJ5IFJlbHlpbmcgUGFydGllcyBhbmQgb25seSBpbiBh
            Y2NvcmRhbmNlIHdpdGggdGhlIENlcnRpZmljYXRlIFBvbGljeSBmb3VuZCBhdCBo
            dHRwczovL2xldHNlbmNyeXB0Lm9yZy9yZXBvc2l0b3J5LzCCAQIGCisGAQQB1nkC
            BAIEgfMEgfAA7gB1ANt0r+7LKeyx/so+cW0s5bmquzb3hHGDx12dTze2H79kAAAB
            ZivltRMAAAQDAEYwRAIgbza1mHawbJ8ykueA0Ik+sm+jBxD9dQKzS9cYO2ZUphsC
            IFVOTtPz1dsHV/9kA2y5vc4KvwI4yUqEI9AZ6EKftaNIAHUApFASaQVaFVReYhGr
            N7wQP2KuVXakXksXFEU+GyIQaiUAAAFmK+W1IAAABAMARjBEAiBiKE5DMVfuV2kP
            qYf93ish9RJj8ldcBiE52OSzUmK7TQIgSd6uR6K1a0hOH2cVm3bUQWOZ4qqvGwLh
            I8UyiuIePqQwDQYJKoZIhvcNAQELBQADggEBABgGwaoCyqomCO2Xan7HgfKD3Si0
            vHNgYtf8mYz3nRKqtXxsIFn1UZGS+lnFfFWOXegvPvUBdasSwQ0gSy7KBE4SxfD3
            Bng1GiaOpnsN2n5Zyi3md/kig4Rn9Vo9QbcONTf1OJaCDuqSSaI+DQFdTOFE+mMO
            0hs0rntJ1ZVX/lOJquVJC2kpeLbizQl8RGy3n1G+qgnrcz7IKzngXLbj01WGqsPe
            O+29jfRk6nac9XB+kKEeszGtvn9UUbQSngM5KP3JbMFPsiAOhQxoy0y1hAZ1VYCM
            zNG+vrgohqTxtGsMsam1C300pZXEBaquAWF2XpxwzX+1zNwOkX+vcwDrjvo=
            -----END CERTIFICATE-----

    /etc/pki/tls/certs/chain.crt:
        mode: "000400"
        owner: root
        group: root
        content: |
            -----BEGIN CERTIFICATE-----
            MIIGKDCCBRCgAwIBAgISA2ZOfXmYFZjub2rqvUtE3aP9MA0GCSqGSIb3DQEBCwUA
            MEoxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MSMwIQYDVQQD
            ExpMZXQncyBFbmNyeXB0IEF1dGhvcml0eSBYMzAeFw0xODA5MzAxODEyNDZaFw0x
            ODEyMjkxODEyNDZaMB4xHDAaBgNVBAMTE2ZpbmRjaGVlc2VoZWFkcy5jb20wggEi
            MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCdinK9WYsxRQGTzYU64qlT1wn/
            D4B5/wImM0jOAJwfH1OTFzm5QHwNOkSEETn9r/em8AQHXRWfyGiWi48HGfiyTUo5
            8tVjmLRXPyB7vGQJdqSRgEU1Hj1aGFrj4Ky4YzgvzpBiWDbN5gYt6ByBB44qSq1X
            KZqqMNi08RtYR8TGg6MXrgt+w8HBZJA7PaxwZzG8ebZVy3GGkW1EpoV2F5ypfTVf
            tTRb3STI6Xy9+rLc0+XqeCUhgAMAJ2e7oJXGQbf8E2TyxSgy+181UW98kA+0dVV6
            ZTzXmkPDmDM7nMvaes32jPchBvfHzPxtJlZV2fCatVZaB1D58uSZ/H3OX1s/AgMB
            AAGjggMyMIIDLjAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEG
            CCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHQYDVR0OBBYEFPVzyaFGPca7LQSU9z54
            w4C64/ptMB8GA1UdIwQYMBaAFKhKamMEfd265tE5t6ZFZe/zqOyhMG8GCCsGAQUF
            BwEBBGMwYTAuBggrBgEFBQcwAYYiaHR0cDovL29jc3AuaW50LXgzLmxldHNlbmNy
            eXB0Lm9yZzAvBggrBgEFBQcwAoYjaHR0cDovL2NlcnQuaW50LXgzLmxldHNlbmNy
            eXB0Lm9yZy8wNwYDVR0RBDAwLoITZmluZGNoZWVzZWhlYWRzLmNvbYIXd3d3LmZp
            bmRjaGVlc2VoZWFkcy5jb20wgf4GA1UdIASB9jCB8zAIBgZngQwBAgEwgeYGCysG
            AQQBgt8TAQEBMIHWMCYGCCsGAQUFBwIBFhpodHRwOi8vY3BzLmxldHNlbmNyeXB0
            Lm9yZzCBqwYIKwYBBQUHAgIwgZ4MgZtUaGlzIENlcnRpZmljYXRlIG1heSBvbmx5
            IGJlIHJlbGllZCB1cG9uIGJ5IFJlbHlpbmcgUGFydGllcyBhbmQgb25seSBpbiBh
            Y2NvcmRhbmNlIHdpdGggdGhlIENlcnRpZmljYXRlIFBvbGljeSBmb3VuZCBhdCBo
            dHRwczovL2xldHNlbmNyeXB0Lm9yZy9yZXBvc2l0b3J5LzCCAQIGCisGAQQB1nkC
            BAIEgfMEgfAA7gB1ANt0r+7LKeyx/so+cW0s5bmquzb3hHGDx12dTze2H79kAAAB
            ZivltRMAAAQDAEYwRAIgbza1mHawbJ8ykueA0Ik+sm+jBxD9dQKzS9cYO2ZUphsC
            IFVOTtPz1dsHV/9kA2y5vc4KvwI4yUqEI9AZ6EKftaNIAHUApFASaQVaFVReYhGr
            N7wQP2KuVXakXksXFEU+GyIQaiUAAAFmK+W1IAAABAMARjBEAiBiKE5DMVfuV2kP
            qYf93ish9RJj8ldcBiE52OSzUmK7TQIgSd6uR6K1a0hOH2cVm3bUQWOZ4qqvGwLh
            I8UyiuIePqQwDQYJKoZIhvcNAQELBQADggEBABgGwaoCyqomCO2Xan7HgfKD3Si0
            vHNgYtf8mYz3nRKqtXxsIFn1UZGS+lnFfFWOXegvPvUBdasSwQ0gSy7KBE4SxfD3
            Bng1GiaOpnsN2n5Zyi3md/kig4Rn9Vo9QbcONTf1OJaCDuqSSaI+DQFdTOFE+mMO
            0hs0rntJ1ZVX/lOJquVJC2kpeLbizQl8RGy3n1G+qgnrcz7IKzngXLbj01WGqsPe
            O+29jfRk6nac9XB+kKEeszGtvn9UUbQSngM5KP3JbMFPsiAOhQxoy0y1hAZ1VYCM
            zNG+vrgohqTxtGsMsam1C300pZXEBaquAWF2XpxwzX+1zNwOkX+vcwDrjvo=
            -----END CERTIFICATE-----
            -----BEGIN CERTIFICATE-----
            MIIEkjCCA3qgAwIBAgIQCgFBQgAAAVOFc2oLheynCDANBgkqhkiG9w0BAQsFADA/
            MSQwIgYDVQQKExtEaWdpdGFsIFNpZ25hdHVyZSBUcnVzdCBDby4xFzAVBgNVBAMT
            DkRTVCBSb290IENBIFgzMB4XDTE2MDMxNzE2NDA0NloXDTIxMDMxNzE2NDA0Nlow
            SjELMAkGA1UEBhMCVVMxFjAUBgNVBAoTDUxldCdzIEVuY3J5cHQxIzAhBgNVBAMT
            GkxldCdzIEVuY3J5cHQgQXV0aG9yaXR5IFgzMIIBIjANBgkqhkiG9w0BAQEFAAOC
            AQ8AMIIBCgKCAQEAnNMM8FrlLke3cl03g7NoYzDq1zUmGSXhvb418XCSL7e4S0EF
            q6meNQhY7LEqxGiHC6PjdeTm86dicbp5gWAf15Gan/PQeGdxyGkOlZHP/uaZ6WA8
            SMx+yk13EiSdRxta67nsHjcAHJyse6cF6s5K671B5TaYucv9bTyWaN8jKkKQDIZ0
            Z8h/pZq4UmEUEz9l6YKHy9v6Dlb2honzhT+Xhq+w3Brvaw2VFn3EK6BlspkENnWA
            a6xK8xuQSXgvopZPKiAlKQTGdMDQMc2PMTiVFrqoM7hD8bEfwzB/onkxEz0tNvjj
            /PIzark5McWvxI0NHWQWM6r6hCm21AvA2H3DkwIDAQABo4IBfTCCAXkwEgYDVR0T
            AQH/BAgwBgEB/wIBADAOBgNVHQ8BAf8EBAMCAYYwfwYIKwYBBQUHAQEEczBxMDIG
            CCsGAQUFBzABhiZodHRwOi8vaXNyZy50cnVzdGlkLm9jc3AuaWRlbnRydXN0LmNv
            bTA7BggrBgEFBQcwAoYvaHR0cDovL2FwcHMuaWRlbnRydXN0LmNvbS9yb290cy9k
            c3Ryb290Y2F4My5wN2MwHwYDVR0jBBgwFoAUxKexpHsscfrb4UuQdf/EFWCFiRAw
            VAYDVR0gBE0wSzAIBgZngQwBAgEwPwYLKwYBBAGC3xMBAQEwMDAuBggrBgEFBQcC
            ARYiaHR0cDovL2Nwcy5yb290LXgxLmxldHNlbmNyeXB0Lm9yZzA8BgNVHR8ENTAz
            MDGgL6AthitodHRwOi8vY3JsLmlkZW50cnVzdC5jb20vRFNUUk9PVENBWDNDUkwu
            Y3JsMB0GA1UdDgQWBBSoSmpjBH3duubRObemRWXv86jsoTANBgkqhkiG9w0BAQsF
            AAOCAQEA3TPXEfNjWDjdGBX7CVW+dla5cEilaUcne8IkCJLxWh9KEik3JHRRHGJo
            uM2VcGfl96S8TihRzZvoroed6ti6WqEBmtzw3Wodatg+VyOeph4EYpr/1wXKtx8/
            wApIvJSwtmVi4MFU5aMqrSDE6ea73Mj2tcMyo5jMd6jmeWUHK8so/joWUoHOUgwu
            X4Po1QYz+3dszkDqMp4fklxBwXRsW10KXzPMTZ+sOPAveyxindmjkW8lGy+QsRlG
            PfZ+G6Z6h7mjem0Y+iWlkYcV4PIWL1iwBi8saCbGS5jN2p8M+X+Q7UNKEkROb3N6
            KOqkqm57TH2H3eDJAkSnh6/DNFu0Qg==
            -----END CERTIFICATE-----

